<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vishu Music - Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1DB954; --bg: #0b0b0b; --surface: #121212; --text: #ffffff; --text-dim: #b3b3b3; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; }
        
        .app-header { position: sticky; top: 0; background: rgba(11,11,11,0.9); backdrop-filter: blur(15px); z-index: 1000; padding: 15px 20px; }
        .brand-name { font-size: 24px; font-weight: 800; margin-bottom: 15px; }
        
        .category-scroll { display: flex; overflow-x: auto; gap: 10px; scrollbar-width: none; }
        .category-scroll::-webkit-scrollbar { display: none; }
        .cat-btn { background: #282828; color: white; border: none; padding: 8px 18px; border-radius: 20px; cursor: pointer; white-space: nowrap; font-size: 13px; font-weight: 600; transition: 0.3s; }
        .cat-btn.active { background: var(--primary); color: black; }

        .tab-content { display: none; height: 100vh; overflow-y: auto; padding: 0 15px 150px 15px; box-sizing: border-box; }
        .active-tab { display: block; }

        .artist-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 10px 0; }
        .artist-card { text-align: center; cursor: pointer; }
        .artist-circle { width: 85px; height: 85px; background: #282828; border-radius: 50%; margin: 0 auto 8px; overflow: hidden; border: 2px solid transparent; }
        .artist-circle img { width: 100%; height: 100%; object-fit: cover; }
        .artist-name { font-size: 12px; font-weight: 600; display: block; height: 35px; overflow: hidden; }

        .song-card { display: flex; align-items: center; padding: 10px; border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
        .song-card img { width: 50px; height: 50px; border-radius: 4px; margin-right: 15px; object-fit: cover; }
        .song-info { flex-grow: 1; overflow: hidden; }
        .song-info h4 { margin: 0; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .song-info p { margin: 3px 0 0 0; font-size: 12px; color: var(--text-dim); }

        .fav-btn { padding: 10px; color: var(--text-dim); }
        .fav-btn.active { color: #e91e63; }

        #player { text-align: center; padding-top: 40px; }
        .album-art-large { width: 80vw; max-width: 280px; aspect-ratio: 1/1; border-radius: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); object-fit: cover; }
        .progress-container { margin: 25px 0; }
        #seek-bar { width: 100%; height: 4px; accent-color: var(--primary); cursor: pointer; }
        .main-controls { display: flex; justify-content: center; align-items: center; gap: 35px; margin-bottom: 30px; }
        .play-main { font-size: 60px; color: white; }
        
        .up-next-container { text-align: left; margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; padding-bottom: 100px; }
        .up-next-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; color: var(--primary); }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; padding: 10px 0 25px 0; z-index: 2000; }
        .nav-item { color: var(--text-dim); text-align: center; font-size: 11px; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); }
        #yt-hidden { position: absolute; top: -1000px; }
    </style>
</head>
<body>

    <div id="home" class="tab-content active-tab">
        <div class="app-header">
            <div class="brand-name">Vishu Music</div>
            <div class="category-scroll">
                 <button class="cat-btn active" onclick="loadCategory('Trending Songs', this)">Trending</button>
                <button class="cat-btn" onclick="loadCategory('Hindi Top Hits', this)">Hindi</button>
                <button class="cat-btn" onclick="loadCategory('Haryanvi Songs', this)">Haryanvi</button>
                <button class="cat-btn" onclick="loadCategory('Latest Top Songs', this)">Latest</button>
                <button class="cat-btn" onclick="loadCategory('New Punjabi Songs', this)">Punjabi</button>
                <button class="cat-btn" onclick="loadCategory('Lo-Fi Hip Hop Songs', this)">Lo-Fi</button>
                <button class="cat-btn" onclick="loadCategory('Bollywood Hits Songs', this)">Bollywood</button>
                <button class="cat-btn" onclick="loadCategory('Sad Songs', this)">Sad</button>
                <button class="cat-btn" onclick="loadCategory('Love Songs', this)">Love</button>
                <button class="cat-btn" onclick="loadCategory('Romantic Songs', this)">Romantic</button>
                <button class="cat-btn" onclick="loadCategory('Arijit Singh Songs', this)">Arijit Singh</button>
                <button class="cat-btn" onclick="loadCategory('Dhanda Nyoliwala Songs', this)">Dhanda Nyoliwala</button>
                 <button class="cat-btn" onclick="loadCategory('Masoom Sharma Songs', this)">Masoom Sharma</button>
                 <button class="cat-btn" onclick="loadCategory('Kd Desi Rock Songs', this)">Kd Desi Rock</button>
                 <button class="cat-btn" onclick="loadCategory('Nusrat Fateh Ali Khan Songs', this)">Nusrat Fateh Ali Khan</button>
                 <button class="cat-btn" onclick="loadCategory('New Hits', this)">New</button>
                </div>
        </div>
        <div id="home-songs-list"></div>
    </div>

    <div id="artists" class="tab-content">
        <h2 style="margin: 25px 0;">Popular Artists</h2>
        <div class="artist-grid" id="artist-list"></div>
    </div>

    <div id="search" class="tab-content">
        <div style="padding: 15px 0;"><input type="text" id="s-input" style="width:100%; padding:12px; border-radius:8px; border:none; background:#282828; color:white;" placeholder="Search..." onchange="searchYT(this.value)"></div>
        <div id="yt-results"></div>
    </div>

    <div id="favorites" class="tab-content"><h2 style="margin:25px 0;">Library</h2><div id="fav-list"></div></div>

    <div id="player" class="tab-content">
        <img id="p-art" class="album-art-large" src="">
        <div style="display:flex; align-items:center; justify-content:center; gap:10px; margin-top:15px;">
            <div style="text-align:center;">
                <h3 id="p-title" style="margin:0;">Select a track</h3>
                <p id="p-artist" style="margin:5px 0 0 0;">Artist Name</p>
            </div>
            <i id="p-fav-icon" class="far fa-heart" onclick="toggleFavoriteFromPlayer()" style="font-size:20px; cursor:pointer;"></i>
        </div>
        <div class="progress-container">
            <input type="range" id="seek-bar" value="0" min="0" max="100" oninput="seekTo(this.value)">
            <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--text-dim); margin-top:5px;">
                <span id="curr-time">0:00</span><span id="total-time">0:00</span>
            </div>
        </div>
        <div class="main-controls">
            <i class="fas fa-step-backward" onclick="prevTrack()" style="font-size:25px;"></i>
            <i id="play-icon" class="fas fa-play-circle play-main" onclick="togglePlay()"></i>
            <i class="fas fa-step-forward" onclick="nextTrack()" style="font-size:25px;"></i>
        </div>
        
        <div class="up-next-container">
            <div class="up-next-title">Up Next</div>
            <div id="up-next-list"></div>
        </div>
        
        <div id="yt-hidden"><div id="yt-player-api"></div></div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" id="n-home" onclick="showTab('home')"><i class="fas fa-home"></i>Home</div>
        <div class="nav-item" id="n-artists" onclick="showTab('artists')"><i class="fas fa-users"></i>Artists</div>
        <div class="nav-item" id="n-search" onclick="showTab('search')"><i class="fas fa-search"></i>Search</div>
        <div class="nav-item" id="n-favorites" onclick="showTab('favorites')"><i class="fas fa-heart"></i>Library</div>
        <div class="nav-item" id="n-player" onclick="showTab('player')"><i class="fas fa-play"></i>Player</div>
    </div>

    <audio id="silent-audio" loop>
        <source src="data:audio/wav;base64,UklGRigAAABXQVZFRm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=" type="audio/wav">
    </audio>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const API_KEYS = ["AIzaSyBt7zNiIw5Ho1KzNPDbWse1iPHeP6b21b4", "AIzaSyAiR4UOiSCY17TSYYR_SfDIbxfGL1Li6mk", "AIzaSyBuIVQzvUs4mo82LxdD3idqzYTUiUyojak"];
        let currentKeyIndex = 0;

        const ARTISTS = [
            { name: "Diljit Dosanjh", img: "Diljit Dosanjh.jpg" }, { name: "Sidhu Moose Wala", img: "Sidhu.jpg" },
            { name: "Nusrat Fateh Ali Khan", img: "Nusrat Fateh Ali Khan.jpg" }, { name: "Karan Aujla", img: "Karan Aujla.jpg" },
            { name: "AP Dhillon", img: "Ap Dhillon.jpg" }, { name: "Arijit Singh", img: "arijit singh.jpg" },
            { name: "Gippy Grewal", img: "Gippy Grewal.jpg" }, { name: "Dhanda Nyoliwala", img: "Dhanda Nyoliwala.jpg" },
            { name: "Kd Desi Rock", img: "Kd.jpg" }, { name: "Mashoom Sharma", img: "Masoom Sharma.jpg" },
        ];

        let ytPlayer, isPlaying = false, playlist = [], currentIndex = 0;
        let favorites = JSON.parse(localStorage.getItem('vishu_favorites')) || [];
        const silentAudio = document.getElementById('silent-audio');

        function onYouTubeIframeAPIReady() {
            ytPlayer = new YT.Player('yt-player-api', {
                events: { 
                    'onStateChange': onStateChange, 
                    'onReady': () => { renderArtists(); loadCategory('Trending Songs'); } 
                }
            });
        }

        async function fetchYT(q) {
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=25&q=${encodeURIComponent(q)}&type=video&key=${API_KEYS[currentKeyIndex]}`);
                const data = await res.json();
                if (data.error && currentKeyIndex < API_KEYS.length - 1) { currentKeyIndex++; return fetchYT(q); }
                return data.items.map(v => ({ id: v.id.videoId, title: v.snippet.title, img: v.snippet.thumbnails.high.url, artist: v.snippet.channelTitle }));
            } catch (e) { return []; }
        }

        function renderArtists() {
            document.getElementById('artist-list').innerHTML = ARTISTS.map(a => `
                <div class="artist-card" onclick="loadCategory('${a.name} Songs')">
                    <div class="artist-circle"><img src="${a.img}" onerror="this.src='https://via.placeholder.com/90?text=${a.name[0]}'"></div>
                    <span class="artist-name">${a.name}</span>
                </div>`).join('');
        }

        function toggleFavorite(song, event) {
            if(event) event.stopPropagation();
            const index = favorites.findIndex(f => f.id === song.id);
            if(index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(song);
            }
            localStorage.setItem('vishu_favorites', JSON.stringify(favorites));
            updateUI();
        }

        function toggleFavoriteFromPlayer() {
            if(playlist[currentIndex]) toggleFavorite(playlist[currentIndex]);
        }

        function updateUI() {
            if(document.getElementById('home').classList.contains('active-tab')) renderList('home-songs-list');
            if(document.getElementById('favorites').classList.contains('active-tab')) renderFavList();
            if(playlist[currentIndex]) {
                const isFav = favorites.some(f => f.id === playlist[currentIndex].id);
                document.getElementById('p-fav-icon').className = isFav ? "fas fa-heart active" : "far fa-heart";
                document.getElementById('p-fav-icon').style.color = isFav ? "#e91e63" : "white";
            }
        }

        function renderFavList() {
            const container = document.getElementById('fav-list');
            if(favorites.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#666; margin-top:50px;'>Library is empty.</p>";
                return;
            }
            container.innerHTML = favorites.map((s, i) => `
                <div class="song-card" onclick="playFromFavs(${i})">
                    <img src="${s.img}">
                    <div class="song-info"><h4>${s.title}</h4><p>${s.artist}</p></div>
                    <i class="fas fa-heart active" style="color:#e91e63; padding:10px;" onclick="toggleFavorite(${JSON.stringify(s).replace(/"/g, '&quot;')}, event)"></i>
                </div>`).join('');
        }

        function playFromFavs(i) {
            playlist = [...favorites];
            loadTrack(i);
        }

        async function loadCategory(query, btn) {
            if(btn) { document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
            showTab('home');
            playlist = await fetchYT(query);
            renderList('home-songs-list');
        }

        function renderList(cid) {
            document.getElementById(cid).innerHTML = playlist.map((s, i) => {
                const isFav = favorites.some(f => f.id === s.id);
                return `
                <div class="song-card" onclick="loadTrack(${i})">
                    <img src="${s.img}">
                    <div class="song-info"><h4>${s.title}</h4><p>${s.artist}</p></div>
                    <i class="${isFav ? 'fas fa-heart active' : 'far fa-heart'} fav-btn" 
                       style="${isFav ? 'color:#e91e63;' : ''}"
                       onclick="toggleFavorite(${JSON.stringify(s).replace(/"/g, '&quot;')}, event)"></i>
                </div>`;
            }).join('');
        }

        function loadTrack(i) {
            currentIndex = i;
            const s = playlist[i];
            document.getElementById('p-title').innerText = s.title;
            document.getElementById('p-artist').innerText = s.artist;
            document.getElementById('p-art').src = s.img;
            ytPlayer.loadVideoById(s.id);
            isPlaying = true;
            silentAudio.play().catch(() => {});
            updateUI();
            renderUpNext();
            showTab('player');
        }

        function togglePlay() { isPlaying ? ytPlayer.pauseVideo() : ytPlayer.playVideo(); }

        function onStateChange(e) { 
            isPlaying = (e.data === 1); 
            document.getElementById('play-icon').className = isPlaying ? "fas fa-pause-circle play-main" : "fas fa-play-circle play-main";
            if(e.data === 0) nextTrack(); 
        }

        // Seek function logic
        function seekTo(value) {
            if(ytPlayer && ytPlayer.getDuration) {
                const newTime = (value / 100) * ytPlayer.getDuration();
                ytPlayer.seekTo(newTime, true);
            }
        }

        function nextTrack() { if(currentIndex < playlist.length-1) loadTrack(currentIndex+1); }
        function prevTrack() { if(currentIndex > 0) loadTrack(currentIndex-1); }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active-tab');
            document.getElementById('n-' + id).classList.add('active');
            if(id === 'favorites') renderFavList();
        }

        // Live timer and seek bar sync
        setInterval(() => {
            if(ytPlayer && ytPlayer.getCurrentTime && isPlaying) {
                const c = ytPlayer.getCurrentTime(), t = ytPlayer.getDuration();
                if(t > 0) {
                    document.getElementById('seek-bar').value = (c / t) * 100;
                    document.getElementById('curr-time').innerText = formatTime(c);
                    document.getElementById('total-time').innerText = formatTime(t);
                }
            }
        }, 1000);

        function formatTime(s) { 
            const m = Math.floor(s / 60), sec = Math.floor(s % 60); 
            return `${m}:${sec < 10 ? '0' : ''}${sec}`; 
        }

        async function searchYT(q) { playlist = await fetchYT(q); renderList('yt-results'); }

        function renderUpNext() {
            const nextList = playlist.slice(currentIndex + 1, currentIndex + 11);
            document.getElementById('up-next-list').innerHTML = nextList.length ? nextList.map((s, i) => `
                <div class="song-card" onclick="loadTrack(${currentIndex + 1 + i})">
                    <img src="${s.img}">
                    <div class="song-info"><h4>${s.title}</h4><p>${s.artist}</p></div>
                </div>`).join('') : "<p style='color:#666; font-size:13px;'>End of playlist</p>";
        }
    </script>
</body>
</html>
